# QueryDsl 만? Vs QueryDsl + Mybatis?

지금 하고 있는 모듈은 QueryDsl 으로만 코드가 작성 되어있다.
처음이라 미숙하지만 기존 코드와의 일관성을 해치기 싫어 QueryDsl 을 고집했었다.

상품이 존재하는 탭만 보이도록 하기 위해 탭에 해당하는 상품이 있는지 조회하는 쿼리를 QueryDsl 로 작성했다.
CaseWhen 으로 Group By 하고 상품 개수를 Count 했다.
전체 탭의 개수를 가져올 수 없어서 해당 작업을 Java 에서 추가적으로 했다.
어거지로 한 느낌이 강했고 쿼리 비용이 비싸 개선의 필요성을 느꼈다.

처음 개선 했을 때는 전시 가능한 상품의 정보를 with 절에 두고,
where 절에서 탭 조건으로 거른 후 union all 하는 방향으로 생각했다.
선배님께 여쭤보니 상품의 개수가 40만개정도 되는데 with 절에 두는 것은 성능상 문제가 될 수 있다고 하시며,
With 절에 Tab 정보를 담고 where 절에서 탭 조건에 맞는 상품이 존재하는지 exist 로 체크 하는 방향을 추천해주셨다.
전체 탭에대한 처리도 with 절에 탭 조건만 추가하면 되니 더 처리할 필요가 없었다.

QueryDsl 에서 With 절을 지원하지않아 이미 설정 되어 있는 Mybatis 를 사용해 적용했다.
적용 후 보니 쿼리 비용도 1/20 정도로 더 저렴해졌고,
전체 탭에대한 처리도 기존 보다 자연스러워져 코드가 전반적으로 더 간결해졌다.

전에 프로모션을 할때는 복잡한 쿼리가 많았어서 이걸 QueryDsl 로 이걸 할 수 있나? 라는 생각이 들며 Mybatis 를 고집했다.
이번에 전시를 하며 직접 써보면서 QueryDsl 의 강력함을 체감했다.
-> 자바 기반으로 되어 있어 공통화 하기 용이했고, 필드 변경이나 잘못 작성한 쿼리를 컴파일 에러로 잡을 수 있다는게 좋았음.
기술에 우위가 있는 것이 아니라 상황에 따라 더 적합한 기술이 있다는 것을 느꼈다.
그래서 한 가지 기술만 고집하지말고 상황에 더 적합한 기술을 섞어서 사용하는게 가장 베스트가 아닌가 싶다.

새로운 프로젝트에서 QueryDsl 을 안 쓸 이유는 없는 것 같고,
기존에 Mybatis 로 되어 있는 소스를 단순히 MyBatis 라는 이유로 QueryDsl 로 옮길 이유도 없는 것 같다.